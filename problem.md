# The Archmage's Layered Spellbook

## Problem Description

Deep in the Tower of Mirrors, the Archmage maintains a magic array of energy crystals `a[1..n]`, each with an initial energy value. Over time, the Archmage performs `q` spells on these crystals.

## Spell Types

### 1. Energy Spell
l r k p x
Where:
- `[l, r]` - range of crystals affected
- `k` - layer ID of the spell
- `p` - parity mode (0 for even, 1 for odd)
- `x` - energy magnitude to add or subtract

### 2. Undo Spell


